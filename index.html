<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>æ¸©é¦¨ç”Ÿæ—¥ç¥ç¦</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #fef5f9 0%, #fff9fb 100%);
            color: #5a3a5a;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            padding-bottom: 20px;
            -webkit-overflow-scrolling: touch;
        }
        
        /* å¾®ä¿¡é¡¶éƒ¨å®‰å…¨åŒºåŸŸ */
        .wechat-top-bar {
            height: env(safe-area-inset-top, 0px);
            background: linear-gradient(to right, #ff6b9d, #ff8ab4);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        /* è£…é¥°å…ƒç´  */
        .decoration {
            position: fixed;
            z-index: 0;
            pointer-events: none;
        }
        
        .heart {
            color: rgba(255, 107, 157, 0.3);
            font-size: 20px;
            animation: float 8s infinite ease-in-out;
        }
        
        .balloon {
            width: 35px;
            height: 45px;
            border-radius: 50%;
            position: fixed;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8) 5%, rgba(255,158,192,0.6) 100%);
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            animation: float-balloon 15s infinite ease-in-out;
        }
        
        .balloon:before {
            content: '';
            position: absolute;
            width: 1.5px;
            height: 50px;
            background-color: rgba(0,0,0,0.1);
            top: 45px;
            left: 16px;
        }
        
        .balloon1 { left: 8%; top: 8%; }
        .balloon2 { right: 12%; top: 12%; animation-delay: -3s; }
        .balloon3 { left: 5%; bottom: 18%; animation-delay: -6s; }
        .balloon4 { right: 8%; bottom: 12%; animation-delay: -9s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }
        
        @keyframes float-balloon {
            0%, 100% { transform: translateY(0) translateX(0); }
            33% { transform: translateY(-25px) translateX(8px); }
            66% { transform: translateY(-10px) translateX(-4px); }
        }
        
        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 15px;
            position: relative;
            z-index: 1;
            padding-top: calc(env(safe-area-inset-top, 0px) + 15px);
        }
        
        /* å¤´éƒ¨ */
        header {
            text-align: center;
            padding: 15px 0 10px;
            position: relative;
        }
        
        .birthday-title {
            font-size: 1.8rem;
            color: #ff6b9d;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .subtitle {
            font-size: 1rem;
            color: #8a5a7a;
            margin-bottom: 10px;
            line-height: 1.4;
            padding: 0 5px;
        }
        
        /* è¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 15px 0;
            padding: 0 5px;
        }
        
        .progress-step {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #e8d4e9;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 5px;
            font-weight: bold;
            color: #fff;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .progress-step.active {
            background-color: #ff6b9d;
            transform: scale(1.1);
        }
        
        .progress-step.completed {
            background-color: #ff9ec0;
        }
        
        .progress-line {
            height: 3px;
            flex: 1;
            max-width: 40px;
            background-color: #e8d4e9;
        }
        
        .progress-line.active {
            background-color: #ff9ec0;
        }
        
        /* å…³å¡å®¹å™¨ */
        .stage-container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px 15px;
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.15);
            margin-bottom: 15px;
            min-height: 320px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 2px solid #ffd1dc;
            position: relative;
            overflow: hidden;
        }
        
        .stage-title {
            font-size: 1.3rem;
            color: #ff6b9d;
            margin-bottom: 12px;
            text-align: center;
            font-weight: bold;
        }
        
        .stage-desc {
            font-size: 0.95rem;
            color: #7a5a6a;
            margin-bottom: 15px;
            line-height: 1.4;
            text-align: center;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            background: linear-gradient(to right, #ff6b9d, #ff8ab4);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 4px 10px rgba(255, 107, 157, 0.3);
            transition: all 0.2s;
            display: inline-block;
            min-width: 140px;
        }
        
        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 5px rgba(255, 107, 157, 0.3);
        }
        
        .btn:disabled {
            background: #cccccc;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* è®°å¿†ç¿»ç‰Œæ¸¸æˆ */
        .memory-card-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 300px;
            margin: 10px auto;
        }
        
        .memory-card {
            width: 100%;
            aspect-ratio: 1;
            background-color: #ffd1dc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.4s;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            user-select: none;
        }
        
        .memory-card.flipped {
            transform: rotateY(180deg);
        }
        
        .memory-card.matched {
            box-shadow: 0 0 10px rgba(255, 107, 157, 0.5);
        }
        
        .memory-card-front, .memory-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .memory-card-front {
            background: linear-gradient(135deg, #ff9ec0, #ff6b9d);
            color: white;
            font-size: 1.2rem;
        }
        
        .memory-card-back {
            background-color: #fff;
            color: #ff6b9d;
            transform: rotateY(180deg);
            border: 2px solid #ffd1dc;
        }
        
        /* ç•™è¨€æ¡† */
        .message-input {
            width: 100%;
            height: 100px;
            padding: 10px;
            font-size: 0.95rem;
            border: 2px solid #ffd1dc;
            border-radius: 10px;
            margin: 10px 0;
            font-family: inherit;
            resize: none;
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        .message-input:focus {
            outline: none;
            border-color: #ff6b9d;
        }
        
        /* ç¥ç¦æ”¶é›† */
        .blessing-collect {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 15px 0;
        }
        
        .blessing-heart {
            font-size: 3.5rem;
            color: #ff6b9d;
            cursor: pointer;
            margin: 10px 0;
            transition: all 0.3s;
        }
        
        .blessing-heart:active {
            transform: scale(1.2);
        }
        
        .blessing-count {
            font-size: 1.1rem;
            color: #ff6b9d;
            margin: 8px 0;
            font-weight: bold;
        }
        
        .blessing-messages {
            width: 100%;
            max-height: 120px;
            overflow-y: auto;
            margin-top: 10px;
            padding-right: 5px;
        }
        
        .blessing-message {
            background-color: rgba(255, 209, 220, 0.25);
            padding: 8px;
            border-radius: 8px;
            margin-bottom: 6px;
            font-size: 0.9rem;
            text-align: left;
            animation: fadeInUp 0.3s forwards;
            border-left: 3px solid #ff6b9d;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* å®Œæˆé¡µé¢ */
        .completion-container {
            text-align: center;
            width: 100%;
        }
        
        .completion-container h2 {
            font-size: 1.5rem;
            color: #ff6b9d;
            margin-bottom: 12px;
        }
        
        .birthday-cake {
            font-size: 4rem;
            margin: 15px 0;
            color: #ff6b9d;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .blessing-text {
            font-size: 1.1rem;
            line-height: 1.5;
            margin: 12px 0;
            text-align: center;
            padding: 12px;
            background-color: rgba(255, 209, 220, 0.25);
            border-radius: 10px;
        }
        
        /* éŸ³ä¹æ’­æ”¾å™¨ */
        .music-player {
            position: fixed;
            bottom: 70px;
            right: 15px;
            z-index: 100;
        }
        
        .music-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b9d, #ff8ab4);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(255, 107, 157, 0.4);
        }
        
        .music-btn:active {
            transform: scale(0.95);
        }
        
        /* å¾®ä¿¡åº•éƒ¨å®‰å…¨åŒºåŸŸ */
        .wechat-bottom-bar {
            height: env(safe-area-inset-bottom, 0px);
            background: linear-gradient(to right, #ff6b9d, #ff8ab4);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        /* æç¤ºä¿¡æ¯ */
        .tip-box {
            background-color: rgba(255, 209, 220, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            margin: 10px 0;
            font-size: 0.85rem;
            color: #7a5a6a;
            text-align: center;
            border-left: 3px solid #ff6b9d;
        }
        
        /* å¾®ä¿¡åˆ†äº«æç¤º */
        .wechat-tip {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.8);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            padding: 20px;
            text-align: center;
            display: none;
        }
        
        .wechat-tip img {
            width: 200px;
            height: 200px;
            margin-bottom: 20px;
        }
        
        .wechat-tip p {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 360px) {
            .memory-card-container {
                grid-template-columns: repeat(3, 1fr);
                max-width: 240px;
            }
            
            .birthday-title {
                font-size: 1.5rem;
            }
            
            .stage-container {
                min-height: 300px;
                padding: 15px 10px;
            }
        }
        
        /* å»é™¤å¾®ä¿¡é»˜è®¤æ ·å¼ */
        a {
            color: inherit;
            text-decoration: none;
        }
        
        img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <!-- å¾®ä¿¡é¡¶éƒ¨å®‰å…¨åŒºåŸŸ -->
    <div class="wechat-top-bar"></div>
    
    <!-- è£…é¥°å…ƒç´  -->
    <div class="decoration heart" style="top: 15%; left: 5%;">â¤ï¸</div>
    <div class="decoration heart" style="top: 20%; right: 8%; animation-delay: -2s;">ğŸ’—</div>
    <div class="decoration heart" style="bottom: 25%; left: 8%; animation-delay: -3s;">ğŸ’•</div>
    <div class="decoration heart" style="bottom: 20%; right: 5%; animation-delay: -5s;">ğŸ’–</div>
    
    <div class="balloon balloon1"></div>
    <div class="balloon balloon2"></div>
    <div class="balloon balloon3"></div>
    <div class="balloon balloon4"></div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <header>
            <h1 class="birthday-title">ğŸ‚ ç”Ÿæ—¥å¿«ä¹ ğŸ‚</h1>
            <p class="subtitle">äº²çˆ±çš„é˜¿å§¨ï¼Œä»Šå¤©æ˜¯æ‚¨çš„ç‰¹åˆ«æ—¥å­<br>è®©æˆ‘ä»¬ä¸€èµ·é€ä¸Šæœ€æ¸©é¦¨çš„ç¥ç¦ï¼</p>
        </header>
        
        <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
        <div class="progress-container">
            <div class="progress-step active" id="step1">1</div>
            <div class="progress-line" id="line1"></div>
            <div class="progress-step" id="step2">2</div>
            <div class="progress-line" id="line2"></div>
            <div class="progress-step" id="step3">3</div>
            <div class="progress-line" id="line3"></div>
            <div class="progress-step" id="step4">4</div>
        </div>
        
        <!-- å…³å¡å®¹å™¨ -->
        <div class="stage-container" id="stageContainer">
            <!-- å†…å®¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- éŸ³ä¹æ’­æ”¾å™¨ -->
        <div class="music-player">
            <div class="music-btn" id="musicBtn">
                <i class="fas fa-play" id="musicIcon"></i>
            </div>
        </div>
        
        <!-- å¾®ä¿¡ä½¿ç”¨æç¤º -->
        <div class="tip-box">
            <i class="fas fa-info-circle"></i> æ¸©é¦¨æç¤ºï¼šç‚¹å‡»æ’­æ”¾æŒ‰é’®å¯æ’­æ”¾ç”Ÿæ—¥æ­Œ
        </div>
    </div>
    
    <!-- å¾®ä¿¡åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <div class="wechat-bottom-bar"></div>
    
    <!-- å¾®ä¿¡åˆ†äº«æç¤ºï¼ˆéšè—ï¼‰ -->
    <div class="wechat-tip" id="wechatTip">
        <p>ç‚¹å‡»å³ä¸Šè§’ â‹®</p>
        <p>é€‰æ‹©"åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"</p>
        <p>å³å¯è·å¾—æœ€ä½³ä½“éªŒ</p>
    </div>

    <script>
        // æ£€æµ‹å¾®ä¿¡æµè§ˆå™¨
        function isWechatBrowser() {
            return navigator.userAgent.toLowerCase().indexOf('micromessenger') !== -1;
        }
        
        // æ˜¾ç¤ºå¾®ä¿¡æç¤º
        function showWechatTip() {
            if (isWechatBrowser()) {
                // å¾®ä¿¡ä¸­å¯èƒ½æœ‰é™åˆ¶ï¼Œä½†æˆ‘ä»¬å¯ä»¥å°è¯•æ’­æ”¾éŸ³é¢‘
                setTimeout(() => {
                    document.getElementById('wechatTip').style.display = 'flex';
                }, 2000);
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥æ˜¯å¦æ˜¯å¾®ä¿¡
            if (isWechatBrowser()) {
                console.log('å¾®ä¿¡æµè§ˆå™¨æ£€æµ‹');
                // æ·»åŠ å¾®ä¿¡ç‰¹å®šä¼˜åŒ–
                document.body.classList.add('wechat-browser');
            }
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame();
            
            // å»¶è¿Ÿæ˜¾ç¤ºå¾®ä¿¡æç¤º
            showWechatTip();
        });
        
        // æ¸¸æˆçŠ¶æ€
        let currentStage = 0;
        let musicPlaying = false;
        
        // å…³å¡æ•°æ®
        const stages = [
            {
                title: "ç¬¬ä¸€å…³ï¼šå›å¿†ç¿»ç¿»ä¹",
                desc: "è¯·ç‚¹å‡»å¡ç‰‡ï¼Œæ‰¾åˆ°æ‰€æœ‰ç›¸åŒçš„å›¾æ¡ˆ",
                content: `
                    <div class="stage-desc">é˜¿å§¨ï¼Œè¿˜è®°å¾—è¿™äº›æ¸©é¦¨æ—¶åˆ»å—ï¼Ÿæ‰¾åˆ°8å¯¹ç›¸åŒçš„å›¾æ¡ˆ</div>
                    <div class="memory-card-container" id="memoryGame"></div>
                    <div class="tip-box">å·²åŒ¹é…: <span id="matchedCount">0</span>/8 å¯¹</div>
                    <button class="btn" id="stage1Btn" disabled>å®Œæˆå…³å¡</button>
                `
            },
            {
                title: "ç¬¬äºŒå…³ï¼šæ¸©é¦¨ç•™è¨€",
                desc: "å†™ä¸‹æ‚¨çš„ç”Ÿæ—¥æ„Ÿè¨€æˆ–æ„¿æœ›",
                content: `
                    <div class="stage-desc">æŠŠæ‚¨çš„ç”Ÿæ—¥ç¥ç¦å†™åœ¨è¿™é‡Œå§</div>
                    <textarea class="message-input" id="birthdayMessage" placeholder="å†™ä¸‹æ‚¨çš„ç”Ÿæ—¥æ„Ÿè¨€æˆ–æ„¿æœ›..."></textarea>
                    <button class="btn" id="stage2Btn">æäº¤ç•™è¨€</button>
                `
            },
            {
                title: "ç¬¬ä¸‰å…³ï¼šæ”¶é›†ç¥ç¦",
                desc: "ç‚¹å‡»çˆ±å¿ƒæ”¶é›†æœ‹å‹ä»¬çš„ç¥ç¦",
                content: `
                    <div class="blessing-collect">
                        <div class="stage-desc">ç‚¹å‡»çˆ±å¿ƒæ”¶é›†ç¥ç¦ï¼Œé›†æ»¡10ä¸ªç¥ç¦å³å¯ç»§ç»­</div>
                        <div class="blessing-heart" id="blessingHeart">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="blessing-count">å·²æ”¶é›†: <span id="blessingCount">0</span>/10</div>
                        <div class="blessing-messages" id="blessingMessages"></div>
                    </div>
                    <button class="btn" id="stage3Btn" disabled>æ”¶é›†å®Œæˆ</button>
                `
            },
            {
                title: "ç”Ÿæ—¥ç¥ç¦",
                desc: "å®Œæˆæ‰€æœ‰å…³å¡ï¼Œé€ä¸Šæœ€çœŸæŒšçš„ç¥ç¦",
                content: `
                    <div class="completion-container">
                        <h2>ğŸ‰ ç”Ÿæ—¥ç¥ç¦ ğŸ‰</h2>
                        <div class="birthday-cake">ğŸ‚</div>
                        <div class="blessing-text">
                            <p>äº²çˆ±çš„é˜¿å§¨ï¼Œ</p>
                            <p>åœ¨æ‚¨çš„ç‰¹åˆ«æ—¥å­é‡Œï¼Œæ„¿å¿«ä¹ã€å¹¸ç¦ã€æ¸©é¦¨ã€å¥½è¿éƒ½å›´ç»•åœ¨æ‚¨èº«è¾¹ï¼</p>
                            <p>ç¥æ‚¨èº«ä½“å¥åº·ï¼Œç¬‘å£å¸¸å¼€ï¼Œé’æ˜¥æ°¸é©»ï¼</p>
                            <p>ç”Ÿæ—¥å¿«ä¹ï¼ğŸ‰ğŸŠ</p>
                        </div>
                        <div style="margin-top: 20px; color: #8a5a7a;">
                            <p>æ¥è‡ªï¼šæ‚¨å­©å­çš„å¥½æœ‹å‹</p>
                            <p><small>${new Date().getFullYear()}å¹´${new Date().getMonth()+1}æœˆ${new Date().getDate()}æ—¥</small></p>
                        </div>
                        <button class="btn" id="restartBtn">å†æ¬¡ç¥ç¦</button>
                    </div>
                `
            }
        ];
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            loadStage(currentStage);
            initMemoryGame();
            initAudioPlayer();
            setupEventListeners();
        }
        
        // åŠ è½½å…³å¡
        function loadStage(stageIndex) {
            const stageContainer = document.getElementById('stageContainer');
            stageContainer.innerHTML = stages[stageIndex].content;
            
            // æ›´æ–°è¿›åº¦
            updateProgress(stageIndex);
            
            // åˆå§‹åŒ–ç‰¹å®šå…³å¡çš„åŠŸèƒ½
            if (stageIndex === 0) {
                initMemoryGame();
            } else if (stageIndex === 2) {
                initBlessingCollection();
            }
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress(stageIndex) {
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                const line = document.getElementById(`line${i-1}`);
                
                if (line) line.classList.remove('active');
                step.classList.remove('active', 'completed');
                
                if (i < stageIndex + 1) {
                    step.classList.add('completed');
                    if (line) line.classList.add('active');
                } else if (i === stageIndex + 1) {
                    step.classList.add('active');
                }
            }
        }
        
        // åˆå§‹åŒ–è®°å¿†æ¸¸æˆ
        function initMemoryGame() {
            const symbols = ['ğŸ‚', 'ğŸ', 'ğŸˆ', 'ğŸ‰', 'ğŸ’', 'âœ¨', 'ğŸ°', 'ğŸ¥‚'];
            const cards = [...symbols, ...symbols];
            cards.sort(() => Math.random() - 0.5);
            
            const container = document.getElementById('memoryGame');
            if (!container) return;
            
            container.innerHTML = '';
            let flippedCards = [];
            let matchedPairs = 0;
            
            cards.forEach((symbol, index) => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.symbol = symbol;
                card.dataset.index = index;
                
                card.innerHTML = `
                    <div class="memory-card-front">?</div>
                    <div class="memory-card-back">${symbol}</div>
                `;
                
                card.addEventListener('click', () => {
                    if (flippedCards.length >= 2 || card.classList.contains('flipped') || card.classList.contains('matched')) {
                        return;
                    }
                    
                    card.classList.add('flipped');
                    flippedCards.push(card);
                    
                    if (flippedCards.length === 2) {
                        const [card1, card2] = flippedCards;
                        
                        if (card1.dataset.symbol === card2.dataset.symbol) {
                            card1.classList.add('matched');
                            card2.classList.add('matched');
                            matchedPairs++;
                            
                            document.getElementById('matchedCount').textContent = matchedPairs;
                            
                            if (matchedPairs === 8) {
                                document.getElementById('stage1Btn').disabled = false;
                            }
                        } else {
                            setTimeout(() => {
                                card1.classList.remove('flipped');
                                card2.classList.remove('flipped');
                            }, 800);
                        }
                        
                        flippedCards = [];
                    }
                });
                
                container.appendChild(card);
            });
        }
        
        // åˆå§‹åŒ–ç¥ç¦æ”¶é›†
        function initBlessingCollection() {
            const messages = [
                "ç¥æ‚¨ç”Ÿæ—¥å¿«ä¹ï¼Œèº«ä½“å¥åº·ï¼",
                "æ„¿æ‚¨ç¬‘å£å¸¸å¼€ï¼Œé’æ˜¥æ°¸é©»ï¼",
                "å¹¸ç¦å®‰åº·ï¼Œä¸‡äº‹å¦‚æ„ï¼",
                "å¤©å¤©å¼€å¿ƒï¼Œå¿ƒæƒ³äº‹æˆï¼",
                "ç¦å¦‚ä¸œæµ·ï¼Œå¯¿æ¯”å—å±±ï¼",
                "å‰ç¥¥å¦‚æ„ï¼Œé˜–å®¶æ¬¢ä¹ï¼",
                "å²æœˆé™å¥½ï¼Œå¹¸ç¦é•¿ä¼´ï¼",
                "å¥åº·å¹³å®‰ï¼Œå¿«ä¹æ¯ä¸€å¤©ï¼",
                "ä¸‡äº‹é¡ºæ„ï¼Œå¥½è¿è¿è¿ï¼",
                "ç”Ÿæ—¥å¿«ä¹ï¼Œæ°¸è¿œç¾ä¸½ï¼"
            ];
            
            let count = 0;
            const heart = document.getElementById('blessingHeart');
            const countEl = document.getElementById('blessingCount');
            const messagesEl = document.getElementById('blessingMessages');
            const button = document.getElementById('stage3Btn');
            
            if (!heart) return;
            
            heart.addEventListener('click', () => {
                if (count >= 10) return;
                
                count++;
                countEl.textContent = count;
                
                const message = document.createElement('div');
                message.className = 'blessing-message';
                message.textContent = messages[Math.min(count - 1, messages.length - 1)];
                messagesEl.appendChild(message);
                messagesEl.scrollTop = messagesEl.scrollHeight;
                
                heart.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    heart.style.transform = 'scale(1)';
                }, 200);
                
                if (count >= 10) {
                    button.disabled = false;
                }
            });
        }
        
        // åˆå§‹åŒ–éŸ³é¢‘æ’­æ”¾å™¨
        function initAudioPlayer() {
            const musicBtn = document.getElementById('musicBtn');
            const musicIcon = document.getElementById('musicIcon');
            
            // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡ï¼ˆå¾®ä¿¡å…¼å®¹ï¼‰
            let audioContext;
            let source;
            
            // ç®€å•çš„ç”Ÿæ—¥å¿«ä¹æ—‹å¾‹ï¼ˆä½¿ç”¨Web Audio APIï¼Œå¾®ä¿¡å…¼å®¹ï¼‰
            function playBirthdayMelody() {
                try {
                    if (!audioContext) {
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    
                    // ç”Ÿæ—¥å¿«ä¹æ­Œçš„ç®€å•æ—‹å¾‹
                    const melody = [
                        {note: 'C4', duration: 0.5},
                        {note: 'C4', duration: 0.5},
                        {note: 'D4', duration: 1},
                        {note: 'C4', duration: 1},
                        {note: 'F4', duration: 1},
                        {note: 'E4', duration: 2},
                        {note: 'C4', duration: 0.5},
                        {note: 'C4', duration: 0.5},
                        {note: 'D4', duration: 1},
                        {note: 'C4', duration: 1},
                        {note: 'G4', duration: 1},
                        {note: 'F4', duration: 2},
                    ];
                    
                    const frequencies = {
                        'C4': 261.63,
                        'D4': 293.66,
                        'E4': 329.63,
                        'F4': 349.23,
                        'G4': 392.00
                    };
                    
                    let time = audioContext.currentTime;
                    
                    melody.forEach((noteObj, index) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = frequencies[noteObj.note];
                        oscillator.type = 'sine';
                        
                        // æ·¡å…¥æ·¡å‡º
                        gainNode.gain.setValueAtTime(0, time);
                        gainNode.gain.linearRampToValueAtTime(0.3, time + 0.01);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, time + noteObj.duration);
                        
                        oscillator.start(time);
                        oscillator.stop(time + noteObj.duration);
                        
                        time += noteObj.duration;
                    });
                    
                    // å¾ªç¯æ’­æ”¾
                    setTimeout(() => {
                        if (musicPlaying) {
                            playBirthdayMelody();
                        }
                    }, time * 1000 + 500);
                    
                } catch (error) {
                    console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', error);
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šæ˜¾ç¤ºæç¤º
                    alert('ç‚¹å‡»ç¡®å®šåï¼Œè¯·æ‰‹åŠ¨ç‚¹å‡»æ’­æ”¾æŒ‰é’®');
                }
            }
            
            // ç‚¹å‡»æ’­æ”¾æŒ‰é’®
            musicBtn.addEventListener('click', function() {
                if (musicPlaying) {
                    // åœæ­¢æ’­æ”¾
                    if (source && source.stop) {
                        source.stop();
                    }
                    musicIcon.className = 'fas fa-play';
                    musicPlaying = false;
                } else {
                    // å¼€å§‹æ’­æ”¾
                    playBirthdayMelody();
                    musicIcon.className = 'fas fa-pause';
                    musicPlaying = true;
                    
                    // å¾®ä¿¡ä¸­éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾éŸ³é¢‘
                    // è¿™é‡Œæˆ‘ä»¬å·²ç»æœ‰äº†ç”¨æˆ·ç‚¹å‡»ï¼Œæ‰€ä»¥åº”è¯¥å¯ä»¥æ’­æ”¾
                }
            });
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // äº‹ä»¶å§”æ‰˜å¤„ç†åŠ¨æ€æŒ‰é’®
            document.addEventListener('click', function(event) {
                const target = event.target;
                
                // ç¬¬ä¸€å…³å®Œæˆ
                if (target.id === 'stage1Btn') {
                    currentStage = 1;
                    loadStage(currentStage);
                }
                
                // ç¬¬äºŒå…³å®Œæˆ
                if (target.id === 'stage2Btn') {
                    const message = document.getElementById('birthdayMessage').value.trim();
                    if (!message) {
                        alert('è¯·å…ˆå†™ä¸‹æ‚¨çš„ç”Ÿæ—¥æ„Ÿè¨€');
                        return;
                    }
                    currentStage = 2;
                    loadStage(currentStage);
                }
                
                // ç¬¬ä¸‰å…³å®Œæˆ
                if (target.id === 'stage3Btn') {
                    currentStage = 3;
                    loadStage(currentStage);
                }
                
                // é‡æ–°å¼€å§‹
                if (target.id === 'restartBtn') {
                    currentStage = 0;
                    loadStage(currentStage);
                }
            });
            
            // ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®éšè—å¾®ä¿¡æç¤º
            document.addEventListener('click', function() {
                document.getElementById('wechatTip').style.display = 'none';
            });
            
            // è§¦æ‘¸äº‹ä»¶å¤„ç†ï¼ˆå¾®ä¿¡ä¼˜åŒ–ï¼‰
            document.addEventListener('touchstart', function() {
                // è§¦æ‘¸äº‹ä»¶å¯ä»¥è§¦å‘éŸ³é¢‘ä¸Šä¸‹æ–‡
                if (!musicPlaying) {
                    // å¯ä»¥åœ¨è¿™é‡Œé¢„åŠ è½½éŸ³é¢‘
                }
            });
        }
    </script>
</body>
</html>
